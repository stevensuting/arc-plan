CKEDITOR.dialog.add("colordialog",function(a){function b(){i.getById(s).removeStyle("background-color"),k.getContentElement("picker","selectedColor").setValue(""),m&&m.removeAttribute("aria-selected"),m=null}function c(a){a=a.data.getTarget();var b;"td"==a.getName()&&(b=a.getChild(0).getHtml())&&(m=a,m.setAttribute("aria-selected",!0),k.getContentElement("picker","selectedColor").setValue(b))}function d(a){a=a.replace(/^#/,"");for(var b=0,c=[];2>=b;b++)c[b]=parseInt(a.substr(2*b,2),16);return"#"+(165<=.2126*c[0]+.7152*c[1]+.0722*c[2]?"000":"fff")}function e(a){!a.name&&(a=new CKEDITOR.event(a));var b=!/mouse/.test(a.name),c=a.data.getTarget(),e;"td"==c.getName()&&(e=c.getChild(0).getHtml())&&(f(a),b?n=c:o=c,b&&(c.setStyle("border-color",d(e)),c.setStyle("border-style","dotted")),i.getById(q).setStyle("background-color",e),i.getById(r).setHtml(e))}function f(a){if(a=!/mouse/.test(a.name)&&n){var b=a.getChild(0).getHtml();a.setStyle("border-color",b),a.setStyle("border-style","solid")}n||o||(i.getById(q).removeStyle("background-color"),i.getById(r).setHtml("&nbsp;"))}function g(b){var d=b.data,e=d.getTarget(),f=d.getKeystroke(),g="rtl"==a.lang.dir;switch(f){case 38:if(b=e.getParent().getPrevious())b=b.getChild([e.getIndex()]),b.focus();d.preventDefault();break;case 40:(b=e.getParent().getNext())&&(b=b.getChild([e.getIndex()]))&&1==b.type&&b.focus(),d.preventDefault();break;case 32:case 13:c(b),d.preventDefault();break;case g?37:39:(b=e.getNext())?1==b.type&&(b.focus(),d.preventDefault(!0)):(b=e.getParent().getNext())&&(b=b.getChild([0]))&&1==b.type&&(b.focus(),d.preventDefault(!0));break;case g?39:37:if(b=e.getPrevious())b.focus(),d.preventDefault(!0);else if(b=e.getParent().getPrevious())b=b.getLast(),b.focus(),d.preventDefault(!0)}}var h=CKEDITOR.dom.element,i=CKEDITOR.document,j=a.lang.colordialog,k,l={type:"html",html:"&nbsp;"},m,n,o,p=function(a){return CKEDITOR.tools.getNextId()+"_"+a},q=p("hicolor"),r=p("hicolortext"),s=p("selhicolor"),t;return function(){function a(a,c){for(var e=a;e<a+3;e++){var f=new h(t.$.insertRow(-1));f.setAttribute("role","row");for(var g=c;g<c+3;g++)for(var i=0;6>i;i++)b(f.$,"#"+d[g]+d[i]+d[e])}}function b(a,b){var d=new h(a.insertCell(-1));d.setAttribute("class","ColorCell"),d.setAttribute("tabIndex",-1),d.setAttribute("role","gridcell"),d.on("keydown",g),d.on("click",c),d.on("focus",e),d.on("blur",f),d.setStyle("background-color",b),d.setStyle("border","1px solid "+b),d.setStyle("width","14px"),d.setStyle("height","14px");var i=p("color_table_cell");d.setAttribute("aria-labelledby",i),d.append(CKEDITOR.dom.element.createFromHtml('<span id="'+i+'" class="cke_voice_label">'+b+"</span>",CKEDITOR.document))}t=CKEDITOR.dom.element.createFromHtml('<table tabIndex="-1" aria-label="'+j.options+'" role="grid" style="border-collapse:separate;" cellspacing="0"><caption class="cke_voice_label">'+j.options+'</caption><tbody role="presentation"></tbody></table>'),t.on("mouseover",e),t.on("mouseout",f);var d="00 33 66 99 cc ff".split(" ");a(0,0),a(3,0),a(0,3),a(3,3);var i=new h(t.$.insertRow(-1));i.setAttribute("role","row"),b(i.$,"#000000");for(var k=0;16>k;k++){var l=k.toString(16);b(i.$,"#"+l+l+l+l+l+l)}b(i.$,"#ffffff")}(),{title:j.title,minWidth:360,minHeight:220,onLoad:function(){k=this},onHide:function(){b();var a=n.getChild(0).getHtml();n.setStyle("border-color",a),n.setStyle("border-style","solid"),i.getById(q).removeStyle("background-color"),i.getById(r).setHtml("&nbsp;"),n=null},contents:[{id:"picker",label:j.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"<div></div>",onLoad:function(){CKEDITOR.document.getById(this.domId).append(t)},focus:function(){(n||this.getElement().getElementsByTag("td").getItem(0)).focus()}},l,{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"<span>"+j.highlight+'</span><div id="'+q+'" style="border: 1px solid; height: 74px; width: 74px;"></div><div id="'+r+'">&nbsp;</div><span>'+j.selected+'</span><div id="'+s+'" style="border: 1px solid; height: 20px; width: 74px;"></div>'},{type:"text",label:j.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 76px;margin-top:4px",onChange:function(){try{i.getById(s).setStyle("background-color",this.getValue())}catch(a){b()}}},l,{type:"button",id:"clear",label:j.clear,onClick:b}]}]}]}]}})